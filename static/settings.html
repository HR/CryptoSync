<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title>Settings</title>
	<link rel="stylesheet" href="style/settings.css">
</head>

<body>
	<section id="settings">
		<div class="panel-container">
			<div class="menu">
				<a class="item navigationLink active" data-target="accounts">Accounts</a>
				<a class="item navigationLink" data-target="crypto">Crypto</a>
				<a class="item navigationLink" data-target="sync">Sync</a>
				<a class="item navigationLink" data-target="contribute">
					<img class="icon" src="images/icons/mark-github.svg" alt="" />
				</a>
				<a class="item right">
					<img class="icon" src="images/icons/CryptoSyncVault_sl.svg" alt="" />
				</a>
			</div>
			<div id="panel-accounts" class="current">
				<section class="accounts">
					<header>
						<img class="icon" src="images/icons/accounts.svg" alt="" />
						<h3>Cloud accounts</h3>
					</header>
					<div class="list" id="accountsList">
					</div>
					<button class="button add">
						<img src="images/icons/add.svg" alt="" class="icon" />
					</button>
				</section>
			</div>
			<div id="panel-crypto">
				<section class="crypto">
					<header>
						<img class="icon" src="images/icons/crypto.svg" alt="">
						<h3>Crypto</h3>
					</header>
					<section class="category">
						<h4>Encryption</h4>
						<div class="options">
							<div class="option">
								<span>Key Length</span>
								<select class="right config" data-config="keyLength">
									<option value="128">128-bit</option>
									<option value="256">256-bit</option>
								</select>
							</div>
							<div class="option">
								<span>Algorithm</span>
								<select class="right config" data-config="algorithm">
									<option value="CTR">CTR</option>
									<option value="CBC">CBC</option>
								</select>
							</div>
							<div class="option">
								<span>Randomness</span>
								<select class="right config" data-config="randomness">
									<option value="pseudo">Pseudo</option>
									<option value="true">True (experimental)</option>
								</select>
							</div>
						</div>
					</section>
					<section class="category">
						<h4>Vault</h4>
						<div class="options">
							<div class="option">
								<span>Encryption key length</span>
								<select class="right config" data-config="MPkeyLength">
									<option value="128">128-bit</option>
									<option value="256" selected>256-bit</option>
								</select>
							</div>
						</div>
					</section>
					<section class="category">
						<h4>MasterPass</h4>
						<div class="options">
							<div class="option">
								<span>Shares</span>
								<select class="right config" data-config="shares">
									<option value="s2n3">s = 2, n = 3</option>
									<option value="s2n4">s = 2, n = 4</option>
								</select>
							</div>
							<div class="option">
								<img class="info" src="images/icons/info.svg" alt="">
								<p class="info">Where n = Number of shares required to reconstruct MasterPass and S = Total number of shares</p>
							</div>
							<div class="option">
								<span>Change</span>
								<button class="right" id="resetMasterPass">Reset</button>
							</div>
						</div>
					</section>
				</section>
			</div>
			<div id="panel-sync">
				<section class="sync">
					<header>
						<img class="icon" src="images/icons/sync.svg" alt="" />
						<h3>Sync</h3>
					</header>
					<section class="category">
						<h4>General</h4>
						<div class="options">
							<div class="option">
								<span>Autostart</span>
								<input type="checkbox" class="right config" data-config="autostart" checked/>
							</div>
							<div class="option">
								<span>Encrypt while offline</span>
								<input type="checkbox" class="right config" data-config="offlineEnc" checked/>
							</div>
							<div class="option">
								<span>Location</span>
							</div>
						</div>
					</section>
				</section>
			</div>
			<div id="panel-contribute">
				<section class="contribute">
					<header>
						<img class="icon" src="images/icons/mark-github.svg" alt="" />
						<h3>Contribute</h3>
					</header>
					<div class="list">
						<div class="item">
							<a class="navigationLink" data-target="https://github.com/HR/CryptoSync/issues">
								<img src="images/icons/issue-opened.svg" class="icon" alt="" />
								<div class="name">
									Report an issue / Give feedback
								</div>
							</a>
						</div>
						<div class="item">
							<a class="navigationLink" data-target="https://github.com/HR/CryptoSync">
								<img src="images/icons/star.svg" alt="" class="icon" />
								<div class="name">
									Star the repo
								</div>
							</a>
						</div>
						<div class="item">
							<a class="navigationLink" data-target="https://github.com/HR/CryptoSync/fork">
								<img src="images/icons/repo-forked.svg" alt="" class="icon" />
								<div class="name">
									Fork the repo
								</div>
							</a>
						</div>
						<div class="item">
							<a class="navigationLink" data-action="checkUpdates">
								<img src="images/icons/package.svg" alt="" class="icon" />
								<div class="name">
									Check for Updates
								</div>
							</a>
						</div>
					</div>
					<footer>
						<img src="images/icons/code.svg" alt="" class="icon" /> with
						<img src="images/icons/heart.svg" alt="" class="icon" /> by
						<br><a class="navigationLink" data-target="https://github.com/HR">Habib Rehman</a>
					</footer>
				</section>
			</div>
		</div>
	</section>
	<script id="account-template" type="text/x-handlebars-template">
		<div class="item">
			<div class="type">
				<div class="profile" style="background:
    url(data:image/gif;base64,{{profileImg}})
    no-repeat
    center center;"></div>
				<div class="cloudType">
					<img src="images/icons/{{type}}.svg"></img>
				</div>
			</div>
			<div class="content">
				<div class="name">{{name}}</div>
				<div class="lastMod">{{email}}</div>
				<div class="qouta">5.76GB / 15GB -> TO IMPLEMENT</div>
			</div>
			<img src="images/icons/remove.svg" data-action="remove{{constructor.name}}" class="icon remove right" />
		</div>
	</script>
	<script type="text/javascript">
		// TODO: Add reset config feature
		window.$ = window.jQuery = require('jquery');
		// load core modules first
		var remote = require('electron').remote,
			gAuth = remote.getGlobal('gAuth'),
			accounts = remote.getGlobal("accounts"),
			Handlebars = require('handlebars'),
			ipcRenderer = require('electron').ipcRenderer,
			remoteWin = remote.getCurrentWindow(),
			settings = remote.getGlobal("settings"),
			mdb = remote.getGlobal("mdb"),
			rconsole = remote.getGlobal("console"),
			shell = require('shell'),
			prr = require('prr'),
			webContents = remoteWin.webContents;
		userSettings = {};

		var context = {
			type: "gdrive",
			name: "Crypto Sync",
			email: "crypto.sync.app@gmail.com",
			profileImg: "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"
		}
		// var html = template(accounts.cryptosync_drive);

		/* Network change event */
		function updateOnlineStatus() {
			ipcRenderer.send('online-status-changed', navigator.onLine ? 'online' : 'offline');
		};
		$(window).on('online', updateOnlineStatus);
		$(window).on('offline', updateOnlineStatus);
		updateOnlineStatus();
		$(window).load(function() {
			//Compile and render template code
			for (var account in accounts) {
				if (accounts.hasOwnProperty(account)) {
					var template = Handlebars.compile($("#account-template").html());
					var account = template(accounts[account]);
				}
			}
			$('#accountsList').append(account);
			// attach click listners
			$(document).on("click", "#resetMasterPass", function() {
				ipcRenderer.send("resetMasterPass");
			});
			$(".navigationLink").each(function(index) {
				$(this).click(function() {
					var target = this.getAttribute("data-target"),
						action = this.getAttribute("data-action");
					$(".active").first().removeClass("active");
					$("a[data-target='" + target + "']").addClass("active");
					if (action) {
						// TODO: Action (i.e. check for updates/open updater)
						console.log(`${this} has data-action attr`);
						ipcRenderer.send(action);
						return;
					}
					navigate(target);
				});
			});

			$(".config").each(function(index) {
				var $this = $(this);
				if (!($.isEmptyObject(settings.user))) {
					// TODO: Load defaults
					console.log("settings.user is not empty");
					setConfig(settings.user);
				}
				$this.change(function() {
					var config = this.getAttribute("data-config");
					var isCheckbox = $this.is(':checkbox');
					var value = (isCheckbox) ? $this.is(':checked') : $this.val();
					rconsole.log(`RENDER: ${config} has changed to ${value} of type ${typeof value}`);
					userSettings[config] = value;
					rconsole.log(`RENDER: Set userSettings[${config}] to ${userSettings[config]}`);
					settings.user = userSettings;
				});
			});
		});

		function setConfig(configObj) {
			for (var config in configObj) {
				if (configObj.hasOwnProperty(config)) {
					var value = configObj[config];
					if ($.type(value) === "boolean") {
						$("[data-config='" + config + "']").prop('checked', value);
					} else {
						$("[data-config='" + config + "']").val(value);
					}
				}
			}
		}

		function navigate(dest) {
			var URLregex = /[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi;
			if (URLregex.test(dest)) {
				shell.openExternal(dest);
				return;
			}
			var oldSel = $('.panel-container > div.current');
			var currSel = $("#panel-" + dest);
			if (oldSel) oldSel.removeClass("current");
			$("#panel-" + dest).addClass("current");
		}
	</script>
</body>

</html>
