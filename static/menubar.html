<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title>Crypto.Sync</title>
	<link rel="stylesheet" href="style/menubar.css">
</head>

<body>
	<section id="menubar">
		<div class="head">
			<a class="left navigationLink" data-target="openSyncFolder" id="openSyncFolder">
				<img class="icon" src="images/icons/folder.svg" alt="" />
			</a>
			<a class="right navigationLink" data-target="openVault">
				<img class="icon" src="images/icons/CryptoSyncVault_sl.svg" alt="" />
			</a>
		</div>
		<header>RECENTLY CHANGED</header>
		<div class="fileList" id="filesList">
		</div>
		<footer>
			<div class="status" id="status">
			</div>
			<a class="right navigationLink" data-target="openSettings">
				<img class="icon" src="images/icons/settings.svg" />
			</a>
			<a class="left navigationLink" data-target="quitApp">
				<img class="icon" src="images/icons/quit.svg" alt="" />
			</a>
		</footer>
	</section>
	<script id="file-template" type="text/x-handlebars-template">
		<div class="item">
			<div class="type">
				<img class="fileType" src="images/icons/filetypes/{{fileType}}.svg">
				<div class="cloudType">
					<img src="images/icons/{{type}}.svg"></img>
				</div>
			</div>
			<div class="content">
				<div class="name">{{name}}</div>
				<div class="lastMod">{{lastMod}}</div>
			</div>
		</div>
	</script>
	<script id="status-template" type="text/x-handlebars-template">
		<img class="icon left {{spin}}" src="images/icons/status/{{status}}.svg" />
		<span>{{statusText}}</span>
	</script>
	<script type="text/javascript">
		window.$ = window.jQuery = require('jquery');
		// load core modules first
		var remote = require('electron').remote,
			ipcRenderer = require('electron').ipcRenderer,
			Handlebars = require('handlebars'),
			status = remote.getGlobal("status"),
			accounts = remote.getGlobal("accounts"), // TODO: check if necessary
			drive = remote.getGlobal("drive"), // TODO: check if necessary
			oauth2 = remote.getGlobal("oauth2"), // TODO: check if necessary
			rconsole = remote.getGlobal("console");

		$(window).on('online', updateOnlineStatus);
		$(window).on('offline', updateOnlineStatus);
		updateOnlineStatus();

		$(window).load(function() {
			// attach click listners
			$(".navigationLink").each(function(index) {
				$(this).click(function() {
					if (this.hasAttribute("data-target")) emittEvent(this.getAttribute("data-target"));
				});
			});
			if ($.isEmptyObject(status)) {
				// TODO: render
			}
			updateStatus(
				{
					status: "syncing",
					statusText: "Syncing"
				}
			);
		});

		/* Helper functions */
		function updateStatus(status) {
			status.spin = (status.status === "syncing") ? "spin" : "";
			var template = Handlebars.compile($("#status-template").html());
			var statusHTML = template(status);
			$('#status').html(statusHTML);
		}

		function addFiles(files) {
			for (var file in files) {
				if (files.hasOwnProperty(file)) {
					var template = Handlebars.compile($("#file-template").html());
					var file = template(files[file]);
					$('#filesList').append(file);
				}
			}
		}

		/* Event emitters  */
		function emittEvent(event) {
			// send event to main
			rconsole.log("RENDER: " + event + " event emitted");
			ipcRenderer.send(event);
		}

		// Network change event
		function updateOnlineStatus() {
			ipcRenderer.send('online-status-changed', navigator.onLine ? 'online' : 'offline');
		};

		/* Event listeners */
		ipcRenderer.on("statusChange", function(event, status) {
			rconsole.log("IPCRENDER: statusChange emitted");
			updateStatus(status);
		});
		var files = {
			first: {
				name:"List of secret keys.docx",
				fileType:"word",
				type:"gdrive",
				lastMod:"22min ago.",
			},
			sec: {
				name:"Computing spec.pdf",
				fileType:"pdf",
				type:"gdrive",
				lastMod:"1h ago.",
			},
			third: {
				name:"Ubuntu_16.04x64.zip",
				fileType:"zip",
				type:"gdrive",
				lastMod:"2 days ago.",
			},
			fourth: {
				name:"matrix.png",
				fileType:"image",
				type:"dropbox",
				lastMod:"1 week ago.",
			}
		};
		addFiles(files);
	</script>
</body>

</html>
