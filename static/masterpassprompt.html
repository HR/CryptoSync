<html>

<head>
	<meta charset="utf-8">
	<title>Unlock the Vault</title>
	<link rel="stylesheet" href="style/masterpassprompt.css" charset="utf-8">
	<!-- <script language="javascript" type="text/javascript" src="js/handle.js"></script> -->
</head>

<body>
	<!-- CS Menubar v1f -->
	<section id="masterpassprompt">
		<img src="images/icons/CryptoSyncvault.svg" alt="some" id="vault" />
		<div class="panel-container">
			<div id="panel-default">
				<header>
					<h1>Unlock the Vault</h1>
					<p>Please enter your Master Password to unlock the vault
					</p>
					<img class="info" src="images/icons/info.svg" alt="" />
					<p class="info">The Vault that contains all the secret keys for your encrypted data is encrypted using a Master Password - your MasterPass</p>
				</header>
				<form onsubmit="return false;">
					<div class="masterpass">
						<input type="password" name="masterpass" id="masterpass" placeholder="********" />
						<label for="password">INCORRECT MASTER PASSWORD</label>
					</div>

					<div class="forgotMP">
						<a class="navigationLink" data-target="reset">Forgot MasterPass?</a>
					</div>

					<div class="submit">
						<input type="submit" value="Unlock" onClick="handleSubmit(); return false;" />
					</div>
				</form>
				<footer>
					<a class="navigationLink" data-target="shares">Got shares?</a>
				</footer>
			</div>
			<div id="panel-shares">
				<header>
					<h1>Unlock the Vault</h1>
					<p>Please enter your Secret Shares to unlock the vault
					</p>
					<img class="info" src="images/icons/info.svg" alt="" />
					<p class="info">The Vault that contains all the secret keys for your encrypted data is encrypted using a Master Password - your MasterPass - constructed using your secret shares</p>
				</header>
				<form onsubmit="return handleShareSubmit()">
					<div class="masterpass">
						<input type="password" name="share" class="" placeholder="********" required/>
						<input type="password" name="share" class="" placeholder="********" required/>
						<input type="password" name="share" class="" placeholder="********" required/>
						<input type="password" name="share" class="" placeholder="********" required/>
						<label for="password">INCORRECT SECRET SHARES(S)</label>
					</div>
					<div class="submit">
						<input type="submit" value="Unlock" />
					</div>
				</form>
				<footer>
					<a class="back navigationLink" data-target="default">
						<img src=" images/icons/back.svg" alt=" " />
					</a>
				</footer>
			</div>
			<div id="panel-reset">
				<header>
					<h1>Reset the MasterPass</h1>
					<p>Please enter a new secure MasterPass
					</p>
					<img class="info" src="images/icons/info.svg" alt=" " />
					<p class="info ">The MasterPass is used to encrypt the Vault. Thus, the strength of the Vault relies on the strength of your password. Resetting your password will prompt the re-encryption of all the data and discard the former encrypted</p>
				</header>
				<form onsubmit="handleReset(); return false;">
					<div class="masterpass">
						<input type="password" name="name" id="name" placeholder="********" required/>
					</div>

					<div class="submit">
						<input type="submit" value="Reset" />
					</div>
				</form>
				<footer>
					<a href="#" class="back navigationLink" data-target="default">
						<img src="images/icons/back.svg" alt="" />
					</a>
				</footer>
			</div>
		</div>
	</section>
	<script type="text/javascript">
		var ipcRenderer = require('electron').ipcRenderer;
		window.$ = window.jQuery = require('jquery');

		function updateOnlineStatus() {
			ipcRenderer.send('online-status-changed', navigator.onLine ? 'online' : 'offline');
		};
		$(window).on('online', updateOnlineStatus);
		$(window).on('offline', updateOnlineStatus);
		updateOnlineStatus();

		navigate("default");
		$(window).load(function() {
			$('.navigationLink').each(function(index) {
				$(this).click(function() {
					if (this.hasAttribute("data-auth")) navigate(this.getAttribute("data-target"), this.getAttribute("data-auth"));
					navigate(this.getAttribute("data-target"));
				});
			});
		});

		function navigate(panelID) {
			var oldSelection = $('.panel-container > div.current');
			if (oldSelection) oldSelection.removeClass("current");
			$("#panel-" + panelID).addClass("current");
		}

		var current = $("div.current");

		function handleSubmit() {
			var MasterPass = current.find("#masterpass"),
				label = current.find("div.masterpass > label");
			console.log("MasterPass: " + MasterPass.val());
			if (!(MasterPass.val())) {
				MasterPass.addClass("invalid");
				label.html("EMPTY MASTERPASS");
				label.css("display", "block");
				label.css("color", "#9F3A38");
			} else {
				// TODO: Send another arg to distinguish input type
				// (i.e. masterpass, shares, reset)
				ipcRenderer.sendSync('masterpass-submission', MasterPass.val(), current.attr('id'));
				label.html("INCORRECT MASTERPASS");
				MasterPass.removeClass("invalid")
				current.find("div.masterpass > label").css("display", "none");
			}
		}
	</script>
</body>

</html>
